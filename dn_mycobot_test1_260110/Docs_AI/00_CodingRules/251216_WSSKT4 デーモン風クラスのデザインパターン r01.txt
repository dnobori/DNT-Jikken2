「251216_WSSKT4 デーモン風クラスのデザインパターン」

このファイルの指示は、ある機能の実装において、「251216_WSSKT4 デーモン風クラス」というパターンの使用が指示された場合に、その部分にのみ適用される。「251216_WSSKT4 デーモン風クラス」が指定された場合は、次のデザインパターンに従って実装すること。


「251216_WSSKT4 デーモン風クラス」とは、ある非同期的な処理をバックグラウンドで行なうクラスを、あたかも、UNIX における「デーモン」や Windows における「サービス」のような存在のプロセス内バージョンのようなものである。


Dispose 戦略:
「251216_VP33AH CSharp .NET コーディング規約」の [JE79ZKW7] に従うこと。

「デーモン風」をどのように実現するか:
(1) クラスのコンストラクタでは、そのクラス全体の制御に係る、初期化時に設定すれば後で変更することが予定されていないクラス内のグローバルなオプション設定など (上記の「AaaOptions」のようなもの) を引数で受け取ってこれを覚えておく程度の処理しかしない。
(2) クラスには public void Start() メソッドがある場合がある (追加オプションの引数を取ってもよい)。これが呼ばれると、まず、「現在 Start 状態にあるか」をチェックし、すでにスタート状態であれば何もしない。それ以外の場合、Start 処理として、バックグラウンドタスクを作成し、それがバックグラウンド処理を開始する。
(3) バックグラウンド処理は、「async Task MainLoopAsync(CancellationToken cancel)」という関数で実装する。これは、cancel が設定されるまで、ずっと回り続ける何らかのバックグラウンド処理であり、非同期関数で実装される。これは大きなループになっていて、StopAsync() が呼ばれるまで回り続ける。何が回り続けるかは、そのタスクの内容によって異なるが、定期的に何らかの処理が呼び出されるものであることが多い。
(4) 


